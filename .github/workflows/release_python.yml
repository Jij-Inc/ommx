name: Release Python SDK

on:
  pull_request:
  workflow_dispatch:

jobs:
  linux:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build wheels
        uses: PyO3/maturin-action@v1
        with:
          command: build
          args: --release --out dist --interpreter 3.8 3.9 3.10 3.11 3.12
          working-directory: ./python
          manylinux: manylinux_2_28

      - name: Upload wheels
        uses: actions/upload-artifact@v4
        with:
          name: linux
          path: ./python/dist
          retention-days: 30

  macos:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build wheels
        uses: PyO3/maturin-action@v1
        with:
          command: build
          args: --release --out dist --interpreter 3.8 3.9 3.10 3.11 3.12
          working-directory: ./python

      - name: Upload wheels
        uses: actions/upload-artifact@v4
        with:
          name: macos
          path: ./python/dist
          retention-days: 30

  windows:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build wheels
        uses: PyO3/maturin-action@v1
        with:
          command: build
          args: --release --out dist --interpreter 3.8 3.9 3.10 3.11 3.12
          working-directory: ./python

      - name: Upload wheels
        uses: actions/upload-artifact@v4
        with:
          name: windows
          path: ./python/dist
          retention-days: 30
